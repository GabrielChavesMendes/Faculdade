<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/stylereceitas.css" />
  <link rel="stylesheet" href="/assets/css/footer.css">
  <link rel="stylesheet" href="/assets/css/nav.css">
  <link rel="stylesheet" href="../assets/css/styleprogresso.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <title>Editar Medicamento</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    button.btn-success {
      margin-top: 20px;
      /* Adiciona espaço entre o botão e o campo acima */
    }

    main {
      flex: 1;
    }

    .container {
      margin-bottom: 2rem;
      /* Adiciona espaço entre o conteúdo e o footer */
    }
  </style>
</head>

<body>
  <main>
    <header>
      <nav class="nav-bar">
        <div class="logo">
          <a href="../pages/index.html"><img src="../assets/images/logMediLog.png" id="logo" alt=""></a>
        </div>
        <div class="nav-list">
          <ul>
            <li class="nav-item"><a href="#inicio" class="nav-link">Início</a></li>
            <li class="nav-item"><a href="#albuns" class="nav-link">Projetos</a></li>
            <li class="nav-item"><a href="#footer" class="nav-link"> Sobre</a></li>
          </ul>
        </div>

        <div class="mobile-menu-icon">
          <button onclick="menuShow()"><img class="icon" src="./assets/img/open-menu-white.svg" alt=""></button>
        </div>
      </nav>
      <div class="mobile-menu">
        <ul>
          <li class="nav-item"><a href="#inicio" class="nav-link">Início</a></li>
          <li class="nav-item"><a href="#albuns" class="nav-link">Projetos</a></li>
          <li class="nav-item"><a href="#footer" class="nav-link">Sobre</a></li>
        </ul>

        <div class="login-button">
          <button><a href="#">Entrar</a></button>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="row justify-content-center bg-light rounded-3 p-4">
          <h1 class="titulo">Medicamento</h1>

          <!-- Editar medicamento -->
          
          <div class="col-12 mb-4">
              <!-- Botão de Expandir/Colapsar com borda -->
              <div class="toggle" onclick="toggleContent(this)">
                  <span class="arrow">&#9654;</span> 
                  <span class="title">Editar Medicamento</span>
              </div>
              
              <!-- Formulário com conteúdo inicial oculto -->
              <div class="content" id="produtoForm">
                <form id="formDoRemedioEditar">
                      <div class="mb-3">
                          <label for="Lote" class="form-label">Lote do produto</label>
                          <input type="text" class="form-control" id="Lote" placeholder="Digite o lote do medicamento" />
                      </div>

                      <div class="mb-3">
                          <label for="quantidadeProduto" class="form-label">Digite a quantidade a ser alterada</label>
                          <input type="number" class="form-control" id="quantidadeProduto" placeholder="Digite a quantidade disponível" />
                      </div>
                      <button type="submit" class="btn btn-success">Editar</button>
                  </form>
              </div>
          </div>

          <!-- Criar medicamento -->

          <div class="col-12">
            <!-- Botão de Expandir/Colapsar com borda -->
            <div class="toggle" onclick="toggleContent(this)">
                <span class="arrow">&#9654;</span> 
                <span class="title">Adicionar Novo Lote de Medicamento</span>
            </div>
            
            <!-- Formulário com conteúdo inicial oculto -->
            <div class="content" id="produtoForm">
              <form id="formDoRemedioCadastro">
                     <div class="mb-3">
                         <label for="codigo" class="form-label">Código do lote</label>
                        <input type="text" class="form-control" id="Codigo" placeholder="Digite o código do lote" />
                   </div>

                    <div class="mb-3">
                        <label for="Fabricação" class="form-label">Data de Fabricação</label>
                        <input type="date" class="form-control" id="Fabricação" placeholder="Digite a data de fabricação do medicamento" />
                    </div>

                    <div class="mb-3">
                        <label for="Validade" class="form-label">Digite a Validade</label>
                        <input type="date" class="form-control" id="Validade" placeholder="Digite a validade do medicamento" />
                    </div>

                    <div class="mb-3">
                      <label for="Id_remedio" class="form-label">Selecione o remédio</label>
                      <select id="Id_remedio" class="form-control select2" placeholder="Digite o nome do remédio">
                          <!-- Opções serão carregadas dinamicamente -->
                      </select>
                  </div>

                    <div class="mb-3">
                      <label for="Quantidade" class="form-label">Digite a Quantidade do Medicamento</label>
                      <input type="number" class="form-control" id="Quantidade" placeholder="Digite a quantidade do medicamento" />
                    </div>

                    <div class="mb-3">
                      <label for="Dosagem" class="form-label">Digite a Dosagem do Medicamento</label>
                      <input type="number" class="form-control" id="Dosagem" placeholder="Digite a dosagem do medicamento" />
                    </div>

                    <button type="submit" class="btn btn-success">Adicionar</button>
                </form>
            </div>
        </div>
      </div>
    </div>
    

    <!-- Modal se necessário -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <!-- Modal content -->
    </div>
  </main>

  <!-- Rodapé -->
  <footer>
    <div id="footer_content">
      <div id="footer_contacts">
        <a href="../pages/index.html"><img src="../assets/images/logMediLog.png" id="logo" alt=""></a>

        <div id="footer_social_media">
          <a href="#" class="footer-link" id="instagram">
            <i class="fa-brands fa-instagram"></i>
          </a>

          <a href="#" class="footer-link" id="facebook">
            <i class="fa-brands fa-facebook-f"></i>
          </a>

          <a href="#" class="footer-link" id="whatsapp">
            <i class="fa-brands fa-whatsapp"></i>
          </a>
        </div>
      </div>

      <ul class="footer-list">
        <li>
          <h3>Blog</h3>
        </li>
        <li>
          <a href="#" class="footer-link">Tech</a>
        </li>
        <li>
          <a href="#" class="footer-link">Adventures</a>
        </li>
        <li>
          <a href="#" class="footer-link">Music</a>
        </li>
      </ul>

      <ul class="footer-list">
        <li>
          <h3>Products</h3>
        </li>
        <li>
          <a href="#" class="footer-link">App</a>
        </li>
        <li>
          <a href="#" class="footer-link">Desktop</a>
        </li>
        <li>
          <a href="#" class="footer-link">Cloud</a>
        </li>
      </ul>

      <div id="footer_subscribe">
        <h3>Subscribe</h3>

        <p>
          Enter your e-mail to get notified about
          our news solutions
        </p>

        <div id="input_group">
          <input type="email" id="email">
          <button>
            <i class="fa-regular fa-envelope"></i>
          </button>
        </div>
      </div>
    </div>

    <div id="footer_copyright">
      &#169
      2024 all rights reserved
    </div>
  </footer>

  <script>

$(document).ready(function () {
    // Inicializa o Select2 para o campo de seleção de remédios
    $('#Id_remedio').select2({
        placeholder: "Digite o nome do remédio",
        allowClear: true,
        ajax: {
            url: "http://localhost:4567/remedios",
            dataType: 'json',
            delay: 250,
            processResults: function (data) {
                return {
                    results: data.map(remedio => ({
                        id: remedio.id,
                        text: remedio.nome
                    }))
                };
            },
            cache: true
        }
    });

    // Evento de submit do formulário
    $('#formDoRemedioCadastro').submit(function (event) {
    event.preventDefault();

    const dadosForm = {
        codigo: $('#Codigo').val(),
        dataFabricacao: $('#Fabricação').val(),
        validade: $('#Validade').val(),
        idRemedio: $('#Id_remedio').val(),
        quantidade: $('#Quantidade').val(),
        dosagem: $('#Dosagem').val()
    };

    console.log("Dados do formulário:", dadosForm); // Verifique os dados enviados

    $.ajax({
        url: "http://localhost:4567/remedio-cadastro",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify(dadosForm),
        success: function (response) {
            alert("Remédio adicionado com sucesso!");
            console.log(response); // Verifique a resposta do servidor

            $('#formDoRemedioCadastro')[0].reset();
                $('#Id_remedio').val(null).trigger('change');
        },
        error: function (xhr, status, error) {
            console.error("Erro ao adicionar remédio:", error);
            alert("Erro ao adicionar remédio: " + error);
        }
    });
});

});



      function toggleContent(element) {
            const content = element.nextElementSibling;
            const arrow = element.querySelector('.arrow');

            if (content.style.display === "none" || content.style.display === "") {
                content.style.display = "block";
                arrow.innerHTML = "&#9660;"; // Seta para baixo
            } else {
                content.style.display = "none";
                arrow.innerHTML = "&#9654;"; // Seta para direita
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
   setTimeout(function () {
     const form = document.querySelector("#formDoRemedioEditar");
     if (form) {
       form.addEventListener("submit", function (event) {
         event.preventDefault();
         remedioUpdate();
         form.reset();
       });
     }
   }, 500); // Aguarda 500ms para garantir que o formulário esteja presente
});


    async function remedioUpdate() {

      var lote = document.getElementById("Lote").value;
      var quant = document.getElementById("quantidadeProduto").value;

      if (!lote || lote.trim() === "") {
        alert("Por favor, insira o codigo do lote.");
        return;
      }

      let url = "http://localhost:4567/remedio-editar";

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          lote: lote,
          quant: quant,
        })
      })
        .then(response => {
          // Verifica se o status da resposta é 200 (OK)
          if (response.ok) {
            alert("Lote atualizado com sucesso!");
            return response.json();
          } else if (response.status === 401) {
            return response.json().then(errorResponse => {
              throw new Error(errorResponse.message);  // Usa a mensagem recebida na resposta
            });// Credenciais incorretas
          } else {
            throw new Error("Erro inesperado na autenticação.");  // Outros erros
          }
        })
        .then(data => { 
         // document.getElementById('formDoRemedio').reset();
        })
        .catch(error => {
          // Exibe uma mensagem de erro para o usuário
          alert(error.message);
        });
    }


  </script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script src="https://kit.fontawesome.com/4e1bc412de.js" crossorigin="anonymous"></script>
  <script src="../assets/js/receita.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>

</html>